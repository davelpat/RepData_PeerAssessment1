---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

```{r load_libs}
require("lubridate", warn.conflicts = FALSE, quietly = TRUE)
require("dplyr", warn.conflicts = FALSE, quietly = TRUE)
```

## Loading and preprocessing the data

Read the data from the [fork of the course git repository][1]. The repository was originally forked from [Reproducable Research Coursera repository][2] on May 4, 2015. The "steps" variable is of type integer with missing values represented as "NA". The "date" variable format is "yyyy-mm-dd" and the "interval" variable format is "hhmm" with leading zeros dropped. "date" and "interval" variables have no missing values. The data is cached to improve iteration processing time.

```{r cache=TRUE}
activity <- tbl_df(read.csv("activity.csv"))
```

## What is mean total number of steps taken per day?

Here is the frequency distribution of the total number of steps taken each day of the study.

```{r compare_na_aves, cache=TRUE}
# analysis across all days in the study, whether data were collected or not
all.daily.steps.count <- activity %>% 
                         group_by(date) %>% 
                         summarize(step.cnt = sum(steps, na.rm = TRUE))

# analysis across only the days of the study when data were collected
daily.steps.count <- aggregate(steps ~ date, activity, sum, na.rm=TRUE)

# and the associated plots
par(mfrow=c(1,2))
hist(all.daily.steps.count$step.cnt,
     breaks = 20,
     col="firebrick",
     xlab = "Total Daily Steps",
     ylab = "Frequency in Days",
     main = "Daily Steps Distribution\nfor All Days")

hist(daily.steps.count$steps,
     breaks = 20,
     col="seagreen",
     xlab = "Total Daily Steps",
     ylab = "Frequency in Days",
     main = "Daily Steps Distribution\nfor Only Days With Data")

all.daily.steps.mean <- mean(all.daily.steps.count$step.cnt)
all.daily.steps.median <- median(all.daily.steps.count$step.cnt)

daily.steps.mean <- mean(daily.steps.count$steps)
daily.steps.median <- median(daily.steps.count$steps)
```

The mean number of steps taken across all days of the study is `r sprintf("%.2f", all.daily.steps.mean)` and the median is `r all.daily.steps.median` steps. However, given that there are eight days in the study for which data are not available, counting those days in the average calculations is misleading. Since the NAs are treated as zero, including the eight days of missing data skews the averages downward, as can be seen in the histograms above. Instead, we should only look at the days in the study for which data are available and calculate the data from them. Using just the days that data ***are*** available, the **mean** number of steps taken each day data were collected during the study is **`r sprintf("%.2f", daily.steps.mean)`** and the **median** is **`r daily.steps.median`** steps.

## What is the average daily activity pattern?

Here is a graph of the daily activity averaged across all the days of the study. The x-axis is the interval and is congruent with military time, i.e. 500 is 5 AM and 1500 is 3 PM.

```{r daily_activity, cache=TRUE}
# analysis across only the days of the study when data were collected
interval.mean.steps <- aggregate(steps ~ interval, 
                                 activity, 
                                 mean, na.rm=TRUE)

#interval.mean.steps <- activity %>% 
#                       group_by(interval) %>% 
#                       summarize(interval.mean = mean(steps, na.rm = TRUE))
with(interval.mean.steps, 
     plot(steps ~ interval, 
          type = "l",
          xlab = "Interval",
          ylab = "Average Steps per Interval",
          main = "Average Daily Activity")
     )

max.interval <- with(interval.mean.steps,
                     interval.mean.steps[steps == max(steps),]
)
```

The interval with the greatest number of steps, on average across all the days data were collected, is **`r max.interval$interval`** with **`r round(max.interval$steps)`** steps, on average.

## Imputing missing values

```{r impute_nas, cache=TRUE}
# how many observations per day? => 288
daily.obs <- 12*24

# get a count of the number of missing values for each day => 2304
daily.nas <- activity %>% 
             group_by(date) %>% 
             summarize(na.cnt = sum(is.na(steps)))
missing.step.values <- sum(daily.nas$na.cnt)

# what's the distribution of missing valuses
plot(daily.nas$na.cnt ~ daily.nas$date, 
     xlab = "",
     ylab = "Missing Intervals",
     main = "Number of Missing Intervals\nby Date")

# how many days have missing values? => 8
empty.dates <- daily.nas[daily.nas$na.cnt > 0, "date"]
empty.day.count <- nrow(empty.dates)

# impute the data for the missing intervals
imputed.activity <- activity %>%
                    mutate(steps = ifelse(is.na(steps), 
                                          interval.mean.steps$steps, 
                                          steps))
```
The total number of missing values is **`r missing.step.values`**. From the graph, it appears that a day either has data or it does not. There appear to be no partially measured days. The number of missing days is `r empty.day.count`.

The strategy to impute the missing data will be to replace the missing interval data with their corresponding average over the days data were actually collected.

```{r compare_imputed, cache=TRUE}
# analysis across all the days of the study with imputed data
imputed.daily.steps.count <- aggregate(steps ~ date, imputed.activity, sum)

#  compare with the same plot and averages as before using the imputed data
par(mfrow=c(1,2))

hist(daily.steps.count$steps,
     breaks = 20,
     ylim = c(0, 20),
     col="seagreen",
     xlab = "Total Daily Steps",
     ylab = "Frequency in Days",
     main = "Daily Steps Distribution\nfor Only Days With Data")

hist(imputed.daily.steps.count$steps,
     breaks = 20,
     ylim = c(0, 20),
     col = "lightgreen",
     xlab = "Total Daily Steps",
     ylab = "Frequency in Days",
     main = "Daily Steps Distribution\nWith Imputed Data")

imputed.steps.mean <- mean(imputed.daily.steps.count$steps)
imputed.steps.median <- median(imputed.daily.steps.count$steps)
```
## Are there differences in activity patterns between weekdays and weekends?

### Links
[1]: https://github.com/davelpat/RepData_PeerAssessment1 "fork of the course git repository"
[2]: http://github.com/rdpeng/RepData_PeerAssessment1 "Reproducable Research Coursera repository"
